---
output: 
    thesisdown::thesis_pdf: default
bibliography: bib/thesis.bib
csl: csl/nature.csl
space_betwee_paragraphs: true
fig_caption: true
always_allow_html: yes
link-citations: true
toc-depth: 2
lot: true
lof: true
indent: true
header-includes: # include other LaTeX packages here
    \usepackage{booktabs}
    \usepackage{longtable}
    \usepackage{siunitx}
    \usepackage[left]{lineno}
    \usepackage{float}
    \floatplacement{figure}{H}
    \linenumbers
    \pagestyle{plain}
    \raggedbottom 
    \usepackage{indentfirst}
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE}
# word count = 
doc.type <- knitr::opts_knit$get('rmarkdown.pandoc.to') # this will tell the .Rmd file what output you are knitting to (word, pdf, html) so that you cna use if else statements when making tables - html/pdf output tables do not work well in word. For word we need to use the 'flextable' packaged to make tables.
## packages
library(dplyr)
library(kableExtra)
library(flextable)
library(wesanderson)
library(cowplot)
library(ggplot2)
options(tinytex.verbose = TRUE)

##### Palettes
d1 <- wes_palette("Royal1", type = "discrete")
d2 <- wes_palette("GrandBudapest2", type = "discrete")
d3 <- wes_palette("Cavalcanti1", type = "discrete")
d4 <- wes_palette("Darjeeling1", type = "discrete")
discrete_wes_pal <- c(d1, d2, d3, d4)
continuous_wes_pal <- wes_palette("Zissou1", 100, type = "continuous")
```

# Associations between adiposity associated metabolites and endometrial cancer: Mendelian randomization analysis {#mediation} 

<style>
body {
text-align: justify}
</style>

### Chapter summary {-}
This Chapter pulls together information from previous Chapters to investigate the effects of adiposity associated metabolites on endometrial cancer. In Chapter \@ref(systematic-review), a systematic review and meta-analysis showed that adiposity was likely causally implicated in 13 diseases as well as other traits including systolic blood pressure and fasting glucose. Of these, endometrial cancer, with which body mass index (BMI) was most strongly related (OR = 1.57; 95% CI = 1.11 -- 2.22; p-value = 0.01), was selected for further investigation in this Chapter. Here, two-sample Mendelian randomization (MR) was used to estimate the association between adiposity (BMI, waist-hip ratio (WHR), and body fat percentage (BF)) and endometrial cancer. Next, two-sample MR was performed to estimate the effect of adiposity-related metabolites, identified in Chapter \@ref(MR), and endometrial cancer. To understand whether metabolites, with evidence of association on endometrial cancer, play an intermediary role in the relationship between adiposity and endometrial cancer, multivariable MR was performed. \par

\newpage

## Introduction {#mediation-introduction}

<!--
Many observational findings have been replicated using Mendelian randomization (MR; Chapter \@ref(systematic-review)), while others, such as c-reactive protein[@Timpson2005; @CCGC2011], have not. Investigations of many cancers have shown consistent estimates across observational and MR analyses, for example BMI is observationally (OR 1.10; 95% CI = 1.07--1.13)[@Bhaskaran2014] and causally (men: OR = 1.23; 95% CI = 1.08--1.38; women: OR = 1.09; 95% CI = 0.97--1.22)[@Bull2020] associated with colorectal cancer. 

Maintaining a *healthy* weight can thus be an effective form of cancer prevention. However, although there is evidence to show that weight loss interventions reduce the risk of cancer[@Ma2017; @Force2018; @Arnold2019; @Luo2017; @Clifton2018; @Brown2016; @Cercato2019], there are many barriers to behavioural weight loss interventions[@McVay2018] not least understanding who will benefit best from what. \par
-->

In Chapter \@ref(introduction) and \@ref(systematic-review), I showed that the number of adiposity-associated diseases is high, consistent with adiposity being a global health concern[@WorldHealthOrganisation2018; @Ritchie2019; @Ng2014; @NCD-RisC2016; @Abarca-Gomez2017] and estimated to be responsible for 8% of global deaths[@Stanaway2018]. Many observational studies have highlighted associations with common diseases, such as cardiovascular disease[@Hubert1983; @Kenchaiah2002; @Yusuf2004; @Cuilin2008; @Gelber2008; @Litwin2008; @Dobbelsteyn2001; @Yusuf2005; @Paul2006; @Koliaki2019; @Eckel1998; @Cepeda-Lopez2010; @Blokhin2013; @Thomsen2014; @Klop2013; @McGill2002; @Ades2017; @Mathew2008; @Plourde2014; @Pathak2015; @Lavie2017; @Kurth2002; @Kernan2013; @Rost2001; @Romero-Corral2010; @Lee2018], cancers[@Bhaskaran2014; @Choi2020; @Kyrgiou2017; @Hu2014; @Hajiebrahimi2013; @Munsell2014; @Harvie2003; @Gaudet2014; @Barrington2015; @Heo2021; @Lauby-Secretan2016; @Barberio2019; @Suzuki2009; @Freisling2017; @Lee2018; @Parra-Soto2021], and common risk factors such as hypertension[@Mathew2008; @Wurtz2014]. Many of these associations have been replicated in Mendelian randomization (MR) studies as discussed in Chapter \@ref(systematic-review). \par

Previous work[@Wurtz2014; @Moore2014; @SantosFerreira2017; @Cirulli2019; @Lau2020; @Brachem2020; @Stevens2020; @OKeeffe2020; @Wulaningsih2019; @Frigerio2021; @Neeland2019; @Bachlechner2016; @Rangel-Huerta2019; @Bull2020; @Bell2021a], and work conducted in Chapter \@ref(observational) and \@ref(MR), has highlighted the numerous metabolites associated, in observational and MR analyses, with measures of adiposity. Many of these adiposity-associated metabolites have been linked with adiposity-associated diseases including type 2 diabetes[@Liu2017c; @Porcu2021], fasting glucose[@Liu2017c; @Porcu2021], colorectal cancer[@Bull2020], and coronary heart disease[@Burgess2016a], implying a potential intermediate role for metabolites. There is also evidence that metabolites can be used to distinguish cancers[@Kovesdy2017]. \par

To date, few studies have investigated the causal relationship between adiposity-associated metabolites and adiposity-associated diseases. As an exemplar analysis to test the potential intermediary role of adiposity-associated metabolites, identified in Chapter \@ref(observational) and \@ref(MR), and adiposity-associated diseases, identified in Chapter \@ref(systematic-review), endometrial cancer was chosen. This was because endometrial cancer met four key requirements: there was strong evidence in Chapter \@ref(systematic-review) for an effect of one or more adiposity measures, there is consistent evidence across observational[@WILD2020] and MR[@Gharahkhani2019; @Painter2016; @Yarmolinsky2019] analyses that adiposity is associated with an increased risk of endometrial cancer, there is a large and publicly available GWAS on endometrial cancer, and the extent to which circulating metabolites may play a role in the relationship between adiposity and endometrial cancer has not been assessed in the literature previously. \par

The World Cancer Report (2020) has identified endometrial cancer (cancer of the inner lining of the uterus) as one cancer that would benefit greatly from reductions in adiposity, as approximately 30-40% of cases are a result of obesity[@WILD2020]. The endometrium is the inner lining of the uterus, consisting of an epithelial cell layer and mucous membrane. The epithelial cell layer consists of two parts, a basal layer and a functional layer which thickens and sheds during menstruation in response to oestrogen and progesterone[@Critchley2020]. Broadly, endometrial cancer is separated into two types: endometrioid (type 1) and non-endometrioid (type 2); the latter being the more aggressive form of the disease. \par 

Endometrioid cancer is the more common type of endometrial cancer and is considered hormone dependent. That is, most endometrioid cancers develop from endometrial hyperplasia which is associated with pro-longed and unopposed oestrogen exposure[@Amant2005]. Non-endometrioid cancer is much less common (~10%) and has typically been considered hormone independent[@Amant2005], however, recent studies suggest that non-endometrioid cancers are very similar to endometrioid cancers in terms of their hormone dependence[@WILD2020]. Though the extent to which they are hormonally driven is likely lesser than endometrioid cancers[@WILD2020]. Molecular differences are apparent between the two types, with *PTEN* mutations (associated with oestrogen exposure) found in many endometrioid cancers and *TP53* and *HER2* (*TP53* is a tumour suppressor gene and *HER2* is a proto-oncogene that promotes cell growth) mutations found in non-endometrioid cancers[@Amant2005]. \par

A leading cause of endometrioid cancer in pre- and post-menopausal women is adiposity: in pre-menopausal women, adiposity leads to insulin resistance, increased androgen, anovulation, and decreased progesterone; in post-menopausal women, adiposity leads to increased oestrogen via excess androgen conversion. In both instances, these changes result in an increase in oestrogen and subsequent endometrial hyperplasia[@Amant2005]. Additionally, there is evidence of oestrogen independent activation of the oestrogen-receptor, primarily through insulin-like growth factor 1[@Lacey2004], which is also up-regulated as a result of adiposity. Although there is evidence that non-endometrioid cancers are hormonally driven, and would therefore likely share risk factors with endometrioid cancer, there is weaker evidence of an association with adiposity compared with endometrioid cancer[@Setiawan2013]. \par

In Chapter \@ref(systematic-review), meta-analysis of three MR studies[@Gharahkhani2019; @Painter2016; @Yarmolinsky2019] found a 1.57 increased risk of endometrial cancer with each SD increase in BMI (95% CI = 1.11 -- 2.22). Previous work has shown different metabolite profiles between overall endometrial cancer cases and controls independent of obesity and other risk factors such as diabetes[@Gaudet2012; @Kliemann2021]. More recently, adiposity-associated metabolites, identified in Chapter \@ref(observational) and \@ref(MR), have been linked with endometrial cancer risk in a prospective cohort[@Dossus2021]. Whether there is a causal effect of metabolites on endometrial cancer development however is unclear. Here, I combine work undertaken in the previous Chapters, which identified metabolites causally related to adiposity, and utilise two-sample MR and two-sample multivariable MR (MVMR) to understand the possible intermediary role played by adiposity-related metabolites on endometrial, endometrioid, and non-endometrioid cancers using data from the largest publicly available metabolomics and endometrial cancer GWAS to date.

## Methods
```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
# associated metabolites
associated_metabolites <- read.table("../../006_interval_metabolites/analysis/associated_metabolites.txt", header = T, sep = "\t")
associated_metabolites <- unique(associated_metabolites$metabolite)
```

This Chapter details hypothesis-driven MR analyses investigating associations between adiposity-related metabolites (here in referred to as metabolites) and endometrial cancer (Figure \@ref(fig:mediation-figure-analysis-flow)). Firstly, a two-sample MR analysis of the effect of multiple measures of adiposity on endometrial cancer was performed to independently validate findings from the meta-analysis performed in Chapter \@ref(systematic-review). Secondly, a two-sample MR analysis of the effect of multiple measures of adiposity on metabolites was performed to obtain the best estimates of the effect of adiposity on metabolites for MR analyses with endometrial cancer. This analysis was performed using recently available data which included the largest currently available GWAS of circulating metabolites conducted in UK Biobank. Thirdly, metabolites with consistent directions of effect across results performed in Chapter \@ref(MR) and this Chapter, were used in a two-sample MR analysis to investigate their effect on endometrial cancer. Finally, metabolites for which there was evidence of an effect on endometrial cancer were taken forward and used in a MVMR analysis with adiposity measures to estimate their intermediate effects on endometrial cancer. \par

All data manipulation and analyses were performed using `R`[@r2019] (version 3.5.3) and `bash`. All code used is available on [GitHub](https://github.com/mattlee821/007_metabolites_outcomes/tree/master/scripts). Two-sample MR analyses were performed using the `TwoSampleMR`[@Hemani2018] (version 0.4.22) `R` package. MVMR analyses were performed using the `MVMR` (version 0.3) `R` package. Summary statistics for adiposity measures and metabolites were obtained from the original GWAS sources (described in the next sextion). Summary statistics for metabolites were from UK Biobank and were obtained from collaborators prior to publication of the GWAS (unpublished; Carolina Borges, University of Bristol). Summary statistics for endometrial cancer were available from MR-Base[@Hemani2018] (accessed 17/07/2021). A list of metabolites used in this Chapter is available in the Appendix (Table \@ref(tab:appendix-mediation-table-metabolites)) and on [GitHub](https://github.com/mattlee821/000_thesis/blob/master/index/data/mediation/tables/metabolites.txt). Results were visualised using the `ggforestplot` (version 0.1.0) `R` package. \par

\newpage
\thispagestyle{empty}
\vspace*{-3cm}

(ref:mediation-figure-overview-cap) **Analysis overview**. In Chapter \@ref(MR), `r length(associated_metabolites)` metabolites were identified as being associated with adiposity. For body mass index (BMI) and waist hip ratio (WHR) these metabolites were identified through directional consistency and multiple testing thresholds across Mendelian randomization and observational analyses. For body fat percentage (BF) metabolites were identified through directional consistency and a multiple testing threshold in the observational analysis only. These `r length(associated_metabolites)` metabolites were taken forward and used in two-sample MR and multivariable MR analyses to investigate intermediate effects on endometrial cancer.

(ref:mediation-figure-overview-scap) Analysis overview

```{r mediation-figure-analysis-flow, echo=FALSE, warning=FALSE, error=FALSE, out.width='100%',fig.cap='(ref:mediation-figure-overview-cap)', fig.scap='(ref:mediation-figure-overview-scap)'}
knitr::include_graphics("../index/data/mediation/figures/overview.pdf")
```

### Data
The following details a number of GWAS and meta-analyses, as per STROBE-MR[@DaveySmith2019], which I did not conduct but that were available to me either via publicly available resources or collaborations. The total N and sex specific N does not always tally which is because of variation in the N for each SNP. Where this is the case, 'N up to' is used. \par

<!--Ancestries (as opposed to ancestry) is used throughout as multiple ancestries are encompassed within the 'European ancestry' classification (see: [https://twitter.com/ewanbirney/status/1148574135284633600?s=20](https://twitter.com/ewanbirney/status/1148574135284633600?s=20)). -->

#### Exposures: Adiposity
##### Body mass index
Detailed information is presented in Chapter \@ref(MR) Section \@ref(MR-exposures-adiposity). Briefly, summary statistics for BMI were obtained from Locke et al. (2015)[@Locke2015], in which 322,154 individuals of European ancestries were included in an inverse variance weighted fixed effects meta-analysis. The reason that this data was used instead of the largest GWAS of BMI conducted by Yengo et al. (comprising both GIANT and UK Biobank) was to avoid sample overlap with the largest available endometrial cancer GWAS conducted in UK Biobank used in this Chapter (see below). A total of 82 GWAS and 43 studies using the Metabochip array were included in the meta-analysis. Individual GWAS were adjusted for age, age^2^, and study specific covariates with residuals inverse normally transformed. Imputation was performed using HapMap phase II CEU reference panel. Each study used a linear regression model assuming an additive genetic model with quality control following procedures outlined previously[@Winkler2014]. A fixed effect inverse variance weighted meta-analysis was performed using METAL for the 82 GWAS and 43 studies using the Metabochip array separately. The final meta-analysis combined the SNPs found in both the meta-analyses of GWAS and Metabochip studies that were corrected for genomic control. A total of 77 loci reaching genome-wide significance (p-value  $\leq$ 5x10^-8^) and separated by at least 500 kilobases were identified.  \par

<!--These SNPs explained ~2% of the variance in BMI.-->

##### Waist hip ratio
Detailed information is presented in Chapter \@ref(MR) Section \@ref(MR-exposures-adiposity). Briefly, summary statistics for WHR were obtained from Shungin et al. (2016)[@Shungin2015], in which 210,088 individuals of European ancestries were included in an inverse variance weighted fixed effects meta-analysis. The reason that this data was used instead of the largest GWAS of WHR conducted by Pulit et al. (comprising both GIANT and UK Biobank) was to avoid sample overlap between the largest available endometrial cancer GWAS conducted in UK Biobank used in this Chapter (see below). A total of 57 GWAS and 44 studies using the Metabochip array were included in the meta-analysis. WHR was adjusted for age, age^2^, study-specific covariates if necessary with residuals inverse normally transformed. Imputation was performed using HapMap phase II CEU reference panel. Each study used a linear regression model assuming an additive genetic model. The final meta-analysis combined the SNPs found in both the meta-analyses of GWAS and Metabochip studies that were corrected for genomic control. A total of 26 loci reaching genome-wide significance (p-value $\leq$ 5x10^-8^) and separated by at least 500 kilobases were identified. \par

<!--variance explained isnt given.-->

##### Body fat percentage
Detailed information is presented in Chapter \@ref(MR) Section \@ref(MR-exposures-adiposity). Briefly, Lu et al. (2016) identified 7 independent SNPs in 89,300 individuals of European ancestries (in a meta-analysis of studies not including UK Biobank). Subsequent work has identified two of these SNPs (rs6738627 and rs2943650) to be associated with *favourable adiposity*[@Yaghootkar2014; @Yaghootkar2016]. *Favourable adiposity* loci have been associated with increased BF, BMI, fat mass, and reduced fat free mass while simultaneously being associated with reduced risk of type-2 diabetes, hypertension, and heart disease, as well as more favourable blood pressure[@Yaghootkar2016]. In additional analyses conducted in Chapter \@ref(MR), comparison of the effect of BF on metabolites, instrumenting BF with the 7 SNPs identified by Lu et al. and a 5 SNP instrument that did not include the 2 *favourable adiposity* SNPs, resulted in tighter confidence intervals for the 5 SNP instrument. Additionally, a number of effect estimates reversed in direction when instrumenting BF using the 5 SNPs. As these *favourable adiposity* SNPs are likely adding noise to the instrumentation of BF, the 5 SNP instrument was used here-in. \par

<!--which explained 0.4% of the variance in BF-->

#### Intermediates: Metabolites
A total of 56 metabolites were identified as being associated with adiposity in Chapter \@ref(MR); one metabolite was not available in the UK Biobank GWAS. Female-specific summary statistics for the 55 available metabolites were obtained from UK Biobank (Borges 2021, unpublished), in which, 118,466 women of European ancestries were included in a linear mixed model GWAS. UK Biobank is a prospective cohort study of ~500,000 individuals from the United Kingdom aged 37--70 with a host of genetic and phenotypic data[@Sudlow2015; @Bycroft2018]. Un-fasted individuals were selected at random to undergo high-throughput NMR metabolomics[@Julkunen2021] using the Nightingale Health Ltd biomarker quantification[@Soininen2009; @Wurtz2017] (version 2020). All metabolites were inverse normally transformed prior to genome wide analysis. Genome-wide association analysis was performed using the MRC IEU, UK Biobank GWAS pipeline[@Mitchell2019]. A linear mixed model using BOLT-LMM, adjusting for genotype array and fasting time was fit for 118,466 individuals. Population structure was controlled for using 143,006 directly genotyped SNPs (minor allele frequency > 0.01; genotyping rate > 0.015; Hardy-Weinberg equilibrium p-value < 0.0001 and linkage disequilibrium (LD) pruning to an R^2^ threshold of 0.1 using PLINKv2.00). Borges et al. had not identfied lead SNPs at the time of writing. Lead SNPs were thus identified as those reaching a genome wide significance threshold (p-value $\leq$ 5x10^-8^) and which were retained after clumping using a LD R^2^ threshold of $0.001$ for SNPs within a $10,000$ base window of each other and using the 1000 Genomes V3 reference panel. \par

#### Outcomes: Endometrial cancer
Female-specific summary statistics for endometrial cancer were available from O'Mara et al. (2018)[@OMara2018]. This data included summary statistics on overall endometrial cancer as well as endometrioid and non-endometrioid cancer. Briefly, 17 studies on endometrial cancer including 12,906 cases and 108,979 country-matched controls of European ancestries were included in an inverse variance weighted fixed effects meta-analysis. Genotypes were imputed using the 1000 Genomes Project v3 reference panel or a combined 1000 Genomes (V3) UK10K reference panel. In each study, univariate GWAS were conducted adjusting for principal components. The analysis was repeated for endometrioid only (cases = 8758; controls = 108,979) and non-endometrioid only (case = 1230; controls = 108,979) cancers. Overall endometrial cancer included the cases from the endometrioid and non-endometrioid cancers alongside a number of other unclassified cases. Of the 12,906 cases and 108,979 controls for overall endometrial cancer, 636 cases (`r round(636/12906*100)`%) and 62,853 controls (`r round(62853/108979*100)`%) were from UK Biobank. For endometrioid and non-endometrioid cancer, no cases and 62,853 controls (`r round(62853/108979*100)`%) were from UK Biobank. \par


#### Overlap
In a two-sample MR analyses, overlap in the exposure and outcome datasets will bias estimates towards the observational confounded effect and increase the false positive rate. This bias will be exacerbated by weak instruments as weak instrument bias will be in the direction of the confounded observational estimate with greater overlap in the two samples (given a strong enough instrument bias as a result of overlap will be close to the un-biased estimate)[@Burgess2016]. For continuous outcomes, bias away from the null is a linear function of the sample overlap (e.g., sample overlap of 50% leads to a bias of 5%). For binary outcomes, when the SNP-outcome association is estimated in all participants, bias is similar to that for a continuous outcome. Where the SNP-outcome association is estimated in controls only, unbiased estimates can be obtained[@Burgess2016]. In the analyses discussed in this Chapter, there is potential overlap between metabolite data (exposure) and overall endometrial cancer data (outcome) of a maximum `r round(636/12906*100)`%. This `r round(636/12906*100)`% maximum overlap would equate to ~0.5% increased false positive rate. \par

### Two-sample Mendelian randomization {#mediation-methods-2smr}
All data manipulation and analyses were performed using `R`[@r2019] (version 3.5.3) and the `TwoSampleMR`[@Hemani2018] (version 0.4.22) `R` package. Summary statistics for BMI[@Locke2015], WHR[@Shungin2015], and BF[@Lu2016] were obtained from published GWAS, as described above, all genetic instruments are available on [GitHub](https://github.com/mattlee821/000_thesis/blob/master/index/data/mediation/tables/adiposity_SNPs.txt). Summary statistics from UK Biobank for metabolites were unpublished, all genetic instruments are available on [GitHub](https://github.com/mattlee821/000_thesis/blob/master/index/data/mediation/tables/metabolite_SNPs.txt), while a list of metabolites used are available in the Appendix (Table \@ref(tab:appendix-mediation-table-metabolites)). Results were visualised using the `ggforestplot` (version 0.1.0) `R` package. \par

For all exposures, the following data were obtained from the original GWAS publications: rsID, effect allele, other/non-effect allele, effect allele frequency, effect estimate, standard error of the effect estimate, p-value, N, and units. The same data for genetic instrumental variables were obtained for the outcome for each exposure separately. Where genetic instrumental variables were not present in the outcome GWAS, proxy SNPs were included if LD was $\geq$ 0.8. For proxy SNPs, the inclusion of SNPs where the reference strand was ambiguous (strand flips) was allowed and the direction was inferred using a minor allele frequency threshold of 0.3. That is, the direction was inferred using a minor allele frequency, so long as that frequency was not $\geq$ 0.3 or $\leq$ 0.7, in which case it was excluded. \par

SNPs for all adiposity measures were not clumped as the studies from which they were obtained stated they were independent or near-independent and analysis in Chapter \@ref(MR) indicated clumping did not considerably alter associations with metabolites. SNPs for all metabolites were identified using a genome-wide significance threshold of p-value $\leq$ 5x10^-8^. Associated SNPs were then clumped using the `TwoSampleMR`[@Hemani2018] `R` package setting a LD R^2^ threshold of $0.001$ for SNPs within a $10,000$ base window of each other and using the 1000 genomes reference panel. Exposure and outcome SNPs were harmonized in reference to the exposure effect allele being on the increasing scale. For included alleles where the reference strand was ambiguous, the positive strand was inferred using effect allele frequency. \par

An inverse variance weighted (IVW), multiplicative random effects (IVW-MRE) model was used to estimate the effect of each exposure on the outcome. The model assumes that the strength of the association of the genetic instruments with the exposure is not correlated with the magnitude of the pleiotropic effects and that the pleiotropic effects have an average value of zero[@Bowden2017]. Where the number of instruments was not sufficient for an IVW-MRE model, the Wald ratio was used. As analysis of the effect of adiposity on endometrial cancer aimed to validate results presented in Chapter \@ref(SR), and analysis of the effect of adiposity on metabolites aimed to obtain updated estimates for metabolites with evidence of association presented in Chapter \@ref(MR), and analysis of the effect of metabolites on endometrial cancer aimed to identify which of those adiposity-associated metabolites were also associated with endometrial cancer, no multiple testing threshold was set for any analysis. For adiposity measures and metabolites, residuals were inverse rank normally transformed prior to genome wide analysis, as such the units represent a standard deviation (SD). For MR analyses using these measures, effect estimates are given in SD units. Results testing for the causal effect of both adiposity and metabolites on endometrial cancer are given as odds ratios (OR) and represent the odds of developing endometrial cancer per SD unit increase in the exposure. \par

#### Sensitivity analysis
Where possible (i.e. 3 or more instruments), the assumptions of no pleiotropy among genetic instruments and outcomes were explored using: MR-Egger[@Bowden2015], weighted median[@Burgess2017a], and weighted mode[@Hartwig2017] based estimators. These methods are sensitive to the effects of potential pleiotropy. No p-value threshold requirements were set for these methods, instead consistency between the IVW-MRE model and these methods was investigated. Briefly, MR-Egger provides an estimate of unbalanced/directional horizontal pleiotropy via the intercept of a linear regression of the SNP-exposure and SNP-outcome association. In the presence of pleiotropy, the intercept will bias away from the origin. MR-Egger gives consistent estimates when 100% of genetic instruments are invalid[@Bowden2015]. The weighted median is complimentary to MR-Egger but does not rely on the "instrument strength independent of direct effect" (InSIDE) assumption. It calculates the median of an empirical distribution of the causal effect estimates weighted for precision. It provides consistent estimates when at least 50% of the weight comes from valid genetic instruments and as long as no one genetic instrument contributes > 50% of the weight[@Burgess2017a]. The weighted mode assumes the true causal effect is the most common effect and it is robust when the majority of effect estimates are derived from valid instruments[@Hartwig2017]. \par

### Two-sample multivariable Mendelian randomization
All adiposity measures were included in the MVMR analysis. Of the metabolites included in the two sample MR analysis estimating the causal effect of adiposity on metabolites and of metabolites on endometrial cancer, only those which showed a consistent direction of effect with both adiposity and endometrial cancer were included in the MVMR analyses. That is, if adiposity increased a metabolite, that metabolite increased endometrial cancer, and adiposity increased endometrial cancer, then the metabolite was considered as a potential intermediate. Otherwise, the metabolite was excluded from MVMR analyses. \par

In MVMR, SNPs for the exposure (adiposity) and proposed intermediate (metabolites) are combined to create a combined instrument of the exposure and intermediate. This combined SNP list is used to extract instruments from the exposure GWAS from the intermediate GWAS. The resulting instrument is then clumped to remove duplicate SNPs and SNPs in LD with one another to avoid double counting effects. The following process was followed for obtaining instruments: \par

The resulting instrument contains SNPs for both the exposure and intermediate; extracting data from the exposure GWAS gives an instrument for the exposure adjusted for the intermediate, and extracting data from the intermediate GWAS gives an instrument for the intermediate adjusted for the exposure (Figure \@ref(fig:mediation-figure-mvmr-dag)). As such, instruments for BMI and instruments for metabolites will use the same SNPs but different estimates. For example, a BMI instrument adjusted for metabolite 1 will include the SNPs associated with BMI and the SNPs associated with metabolite 1, with all data extracted from the BMI GWAS. An instrument for metabolite 1 adjusted for BMI will include the SNPs associated with BMI and the SNPs associated with metabolite 1, with all data extracted from the metabolite 1 GWAS. 
 

1. SNPs associated with each adiposity measure and each metabolite were identified in the same way as for the two sample MR analysis described previously (\@ref(mediation-methods-2smr))
2. Identified SNPs for each adiposity and metabolite pair were combined to create a SNP list for each adiposity and metabolite pair
3. These SNP lists were used to extract summary level data for instruments (rsID, effect allele, other/non-effect allele, effect allele frequency, effect estimate, standard error of the effect estimate, p-value, N, and units) from the GWASs of each adiposity measure and each metabolite individually
4. Each instrument was clumped using the `TwoSampleMR`[@Hemani2018] `R` package setting an LD R^2^ threshold of $0.001$ for SNPs within a $10000$ base window of each other and using the $1000$ genomes reference panel
5. Each adiposity and metabolite instrument pair were harmonised in reference to the adiposity instrument effect allele being on the increasing scale 
6. Instruments for each adiposity and metabolite pair were extracted from the endometrial cancer GWAS using MR-Base. Where SNPs were not present in the outcome GWAS, proxy SNPs were included if LD was $\geq$ 0.8. For proxy SNPs, the inclusion of SNPs where the reference strand was ambiguous (strand flips) was allowed and the direction was inferred using a minor allele frequency threshold of 0.3
7. The outcome instruments were harmonised in reference to the adiposity instrument effect allele being on the increasing scale

(ref:mediation-figure-mvmr-dag-cap) **Directed acyclic graph of multivariable MR principle**. The DAG illustrates the principle of multivariable MR using an exposure (X1) and a mediator (X2) on a single outcome. Genetic instruments (G) associated with X1 and X2 are combined into an instrument, in this example the instrument includes G1, G2, and any number of other SNPs (Gn). The instrument is extracted from summary statistics for each of X1 and X2. G = single nucleotide polymorphism; X1 = exposure, X2 = mediator; Y = outcome; U = unmeasured confounding

(ref:mediation-figure-mvmr-dag-scap) Directed acyclic graph of multivariable MR principle

```{r mediation-figure-mvmr-dag, echo=FALSE, warning=FALSE, error=FALSE, fig.align='center', out.width='75%',fig.cap='(ref:mediation-figure-mvmr-dag-cap)', fig.scap='(ref:mediation-figure-mvmr-dag-scap)', warning=FALSE, error=FALSE, message=FALSE}
library(ggdag)
# dags ====
theme_set(theme_dag())
## mr dag 3
# set coordinates
coords <- tibble::tribble(~name, ~x, ~y,
                          "G1", 0,0,
                          "G2", 0,-0.5,
                          "Gn", 0,-1,
                          "X1", 1,0,
                          "X2", 1,-1,
                          "Y", 2,0,
                          "U", 1.5,1)
# make dag ====
dag <- dagify(X1 ~ G1,
              X2 ~ G1,
              X1 ~ G2,
              X2 ~ G2,
              X1 ~ Gn,
              X2 ~ Gn,
              X2 ~ X1,
              Y ~ X1,
              Y ~ X2,
              X1 ~U, 
              X2 ~ U,
              Y ~ U,
              coords = coords)
ggdag(dag, text = TRUE, edge_type = "link_arc", stylized = FALSE)
```

For MVMR analysis, the SNP, effect estimate, and standard error for each exposure (adiposity and metabolite) and outcome are required. Instrument strength for each exposure was estimated using a generalized version of Cochran's Q[@Sanderson2019b; @Sanderson2021a] using the `strength_mvmr()` function in the `MVMR` `R` package assuming a pairwise covariance of 0. The assumption being that the associations between the SNP and exposure are estimated in independent samples. Horizontal pleiotropy was evaluated using a modified form of Cochran's Q using the `pleiotropy_mvmr()` function in the `MVMR` `R` package and assuming a pairwise covariance of 0. \par

An IVW MVMR model was used to obtain the direct causal effect of each adiposity measure adjusted for each metabolite and each metabolite adjusted for each adiposity measure on endometrial cancer risk. Results from these analyses will inform as to whether the effect of adiposity on endometrial cancer is partly explained by the effect of adiposity on metabolites and those metabolites effects on endometrial cancer. Additionally, it is possible that the effect of metabolites on endometrial cancer may be independent of the effect of adiposity on metabolites and the metabolites are therefore not solely intermediates but are also direct causes of endometrial cancer. Results are presented as OR and represent the odds of developing endometrial cancer per SD unit increase in the exposure. \par

## Results
For this section, results are presented first for the two-sample MR analyses of the effect of adiposity on endometrial cancer, the effect of adiposity on metabolites in UK Biobank, and the effect of those metabolites for which there was evidence for a causal effect of adiposity (consistent across analyses conducted in Chapter \@ref(MR) and UK Biobank here) and endometrial cancer. Finally, results from the two-sample MVMR analyses unpicking the potential intermediary role of these metabolites in the relationship between adiposity and endometrial cancer are presented. \par

### Two-Sample Mendelian randomization: effect of adiposity measures on endometrial cancer
```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
# data 
data <- read.table("../../007_metabolites_outcomes/analysis/001_adiposity_endometrial/001_MR_results.txt", header = T, sep = "\t")
data$group[data$exposure == "Locke BMI EU sex combined 77 SNPs clumped"] <- "BMI"
data$group[data$exposure == "Shungin WHR EU sex combined 26 SNPs"] <- "WHR"
data$group[data$exposure == "Lu BF EU sex combined 5 SNPs"] <- "BF"
data$outcome_label[data$outcome == "Endometrial cancer (endometrioid histology) || id:ebi-a-GCST006465"] <- "Endometrioid"
data$outcome_label[data$outcome == "Endometrial cancer (Non-endometrioid histology) || id:ebi-a-GCST006466"] <- "Non-endometrioid"
data$outcome_label[data$outcome == "Endometrial cancer || id:ebi-a-GCST006464"] <- "Endometrial cancer"
data$method[data$method == "Inverse variance weighted (multiplicative random effects)"] <- "IVW-MRE"

data <- subset(data, method == "IVW-MRE")
bmi <- subset(data, group == "BMI")
whr <- subset(data, group == "WHR")
bf <- subset(data, group == "BF")
```
Here, using the largest endometrial cancer GWAS to date, the MR analyses performed as part of this thesis provided strong evidence for a causal effect of BMI on endometrial cancer (OR per SD unit increase in BMI = `r round(bmi$OR[1],2)`; 95% CI = `r round(bmi$lower_ci[1],2)`--`r round(bmi$upper_ci[1],2)`; p-value = 1.74 x 10^-15^; (Table \@ref(tab:mediation-table-adiposity-cancer)). A similar effect (OR = `r round(bmi$OR[2],2)`; 95% CI = `r round(bmi$lower_ci[2],2)`--`r round(bmi$upper_ci[2],2)`; p-value = 1.59 x 10^-13^) was found for endometrioid cancer, while a smaller effect was observed for non-endometrioid cancer (OR = `r round(bmi$OR[3],2)`; 95% CI = `r round(bmi$lower_ci[3],2)`--`r round(bmi$upper_ci[3],2)`; p-value = `r round(bmi$pval[3],2)`). \par

The effect of WHR on the three outcomes was less clear. Though effect estimates were all in line with those for BMIF, only the effect of WHR on non-endometrioid cancer (OR = `r round(whr$OR[3],2)`; 95% CI = `r round(whr$lower_ci[3],2)`--`r round(whr$upper_ci[3],2)`; p-value = `r round(whr$pval[3],2)`) had confidence intervals that did not cross the null. The effect of BF on endometrial cancer (OR = `r round(bf$OR[1],2)`; 95% CI = `r round(bf$lower_ci[1],2)`--`r round(bf$upper_ci[1],2)`; p-value = 1.02 x 10^-16^), endometrioid (OR = `r round(bf$OR[2],2)`; 95% CI = `r round(bf$lower_ci[2],2)`--`r round(bf$upper_ci[2],2)`; p-value = 9.93 x 10^-7^), and non-endometrioid (OR = `r round(bf$OR[3],2)`; 95% CI = `r round(bf$lower_ci[3],2)`--`r round(bf$upper_ci[3],2)`; p-value = `r round(bf$pval[3],2)`) were more similar to that of BMI though with larger effect sizes and wider confidence intervals. \par

Sensitivity analyses, which included weighted median, weighted mode, and MR-Egger models, were consistent with the IVW-MRE model for each exposure (Appendix Figure \@ref(fig:appendix-mediation-figure-forestplot-adiposity-endometrial)). All figures associated with sensitivity analyses (e.g. leave one out analyses) are available on [GitHub](https://github.com/mattlee821/000_thesis/tree/master/index/data/mediation/figures/001_adiposity_endometrial) with representative figures presented in the appendix (Appendix \@ref(appendix-mediation)). All results are available on [GitHub](https://github.com/mattlee821/000_thesis/tree/master/index/data/mediation/results/001_adiposity_endometrial). \par

```{r mediation-table-adiposity-cancer, eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
table <- data[,c("group", "outcome_label", "OR", "lower_ci", "upper_ci", "pval")]

knitr::kable(table, longtable = T, booktabs = T, format = "latex", escape = F, digits = 2,
    caption = 'Two-sample Mendelian randomisation results: the effect of adiposity measures on endometrial cancer', row.names = F,
    col.names = c("","", "OR", "lowe ci", "upper ci", "p-value")) %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "repeat_header"), position = "center") %>%
  kableExtra::footnote(general = "Odds ratios (OR) and associated 95% confidence intervals (CI) per standard deviation unit increase in body mass index (BMI), waist hip ratio (WHR), or body fat percentage (BF)", threeparttable = T, general_title = "", footnote_as_chunk = T)

```

### Two-sample Mendelian randomization: effect of adiposity measures on metabolites
In Chapter \@ref(MR), 46, 49, and 9 metabolites were associated with BMI, WHR, and BF respectively. Of these metabolites, two (serum total triglycerides and estimated description of fatty acid chain length not actual carbon number) were not measured in UK Biobank and so were not available for analyses. As such, a total of 45, 48, and 8 metabolites, which were associated with BMI, WHR, and BF, respectively, in Chapter \@ref(MR), were available for analysis in UK Biobank. \par

For BMI, of the 45 metabolites, 4 had directions of effect that were not consistent with the previous MR analysis (Chapter \@ref(MR)), meta-analysis (Chapter \@ref(MR)), and observational (Chapter \@ref(observational)) analyses: apolipoprotein B, free cholesterol in medium VLDL, total lipids in medium VLDL, total lipids in very small VLDL. For WHR, of the 48 metabolites, 2 had directions of effect that were not consistent with the previous MR analysis (Chapter \@ref(MR)), meta-analysis (Chapter \@ref(MR)), and observational (Chapter \@ref(observational)) analyses: phenylalanine and tyrosine. For BF, all 8 of the analysed metabolites had consistent directions of effect with the previous MR analysis (Chapter \@ref(MR)), meta-analysis (Chapter \@ref(MR)), and observational (Chapter \@ref(observational)) analyses. Sensitivity analyses did not highlight metabolite analyses which violated the MR assumptions. As such, a total of 41, 46, and 8 metabolites were taken forward for MR analysis to estimate the effect of these metabolites on endometrial cancer outcomes. \par

All results for the investigation of the effect of adiposity measures on metabolites measured in UK Biobank are presented in Appendix Figure \@ref(fig:appendix-mediation-figure-forestplot-adiposity-metabolites) and are available on [GitHub](https://github.com/mattlee821/000_thesis/tree/master/index/data/mediation/results/002_adiposity_metabolite). All sensitivity plots are available on [GitHub](https://github.com/mattlee821/000_thesis/tree/master/index/data/mediation/figures/002_adiposity_metabolite) and representative figures are presented in the appendix (Appendix \@ref(appendix-mediation)). \par

### Two-sample Mendelian randomization: effect of adiposity-associated metabolites on endometrial cancer
```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
data <- read.table("../../007_metabolites_outcomes/analysis/003_metabolite_endometrial/mr_results_formatted_associated_metabolites.txt", header = T, sep = "\t")
unique_metabolites <- unique(data$metabolite)
n_metabolites <- read.table("../../007_metabolites_outcomes/analysis/003_metabolite_endometrial/total_associated_metabolites.txt", header = T, sep = "\t")
metabs <- n_metabolites[,1]
SNPS <- read.table("../../007_metabolites_outcomes/data/metabolite_instruments.txt", header = T, sep = "\t")
SNPS <- SNPS[SNPS$exposure %in% metabs,]
n_SNPS <- SNPS[!duplicated(SNPS$SNP), ]

freq_SNP <- SNPS %>% 
  group_by(SNP) %>% 
  mutate(count=n())
freq_SNP <- freq_SNP[!duplicated(freq_SNP$SNP), ]
freq_one_SNP <- subset(freq_SNP, count == 1)


# venndiagram of metab overlap
# data <- read.table("../007_metabolites_outcomes/analysis/002_adiposity_metabolite/001_mr_results.txt", header = T, sep = "\t")
# bmi <- subset(data, exposure == "bmi")
# bmi <- bmi$metabolit
# bmi <- bmi[order(bmi)]
# 
# whr <- subset(data, exposure == "whr")
# whr <- whr$metabolit
# whr <- whr[order(whr)]
# 
# bf <- subset(data, exposure == "bf")
# bf <- bf$metabolit
# bf <- bf[order(bf)]
# 
# x <- list(bmi=bmi,whr=whr,bf=bf)
# v0 <- venn.diagram(x, filename=NULL, 
#                     fill = c("red", "blue", "green"),
#                     alpha = 0.50,
#                     col = "transparent")



```
Two-sample MR analysis was used to investigate the causal effect of `r nrow(n_metabolites)` metabolites (i.e., 41, 46, and 8 metabolites driven by BMI, WHR, and BF, respectively) on endometrial cancer. A total of 7 and 5 metabolites were only found to be associated with WHR and BF respectively. Two metabolites were found to be associated with BMI and BF and 38 metabolites were associated with BMI and WHR. One metabolite, valine, was associated with all three measures. Instruments for metabolites were obtained from an unpublished GWAS of 249 circulating metabolites performed in UK Biobank (Borges, unpublished). Using a genome wide p-value threshold of 5x10^-8^ and an LD R^2^ clumping threshold for SNPs within a 10,000 base window, to ensure independance of SNPs, identified `r nrow(SNPS)` total associations with 53 metabolites (unique number of SNPs = `r nrow(n_SNPS)`; minimum number of SNPs associated with a metabolite = `r min(table(SNPS$exposure))`, maximum number of SNPs associated with a metabolite = `r max(table(SNPS$exposure))`; Figure \@ref(fig:mediation-figure-metabolites-snp-distribution)). The greater the number of SNPs associated with a trait, the larger the variance explained by those SNPs and thus the power afforded by that instrument in an MR analysis. Of the `r nrow(n_SNPS)` unique SNPs identified, `r round(nrow(freq_one_SNP)/nrow(freq_SNP)*100,0)`% of SNPs were associated with just one metabolite each (Figure \@ref(fig:mediation-figure-metabolites-snp-numbers)). The remaining `r 100-round(nrow(freq_one_SNP)/nrow(freq_SNP)*100,0)`% of SNPs were associated with 2 or more metabolites, with one SNP (rs12154627) associated with `r max(freq_SNP$count)` metabolites. \par

(ref:mediation-figure-metabolites-snp-distribution-cap) **Distribution of the number of SNPs individual metabolites were associated with**. A total of `r nrow(n_SNPS)` unique SNPs were identified across 53 metabolites. The number of SNPs associated with each metabolite varied between `r min(table(SNPS$exposure))` and `r max(table(SNPS$exposure))` with a mean of `r round(mean(table(SNPS$exposure)))`. Bin size = 10.

(ref:mediation-figure-metabolites-snp-distribution-scap) Distribution of the number of SNPs individual metabolites were associated with

```{r mediation-figure-metabolites-snp-distribution, echo=FALSE, out.width='100%', fig.cap='(ref:mediation-figure-metabolites-snp-distribution-cap)', fig.scap='(ref:mediation-figure-metabolites-snp-distribution-scap)'}
data <- SNPS %>% 
  group_by(exposure) %>% 
  mutate(count=n())
data <- data[!duplicated(data$exposure), ]

ggplot(data, 
       aes(x = count)) + 
  geom_histogram(binwidth = 10, alpha = 1,
                 color = discrete_wes_pal[1],
                 fill = discrete_wes_pal[1]) + 
  xlab("Total number of SNPs a metabolites is associated with") + ylab("Frequency") +
  theme_cowplot()
```

(ref:mediation-figure-metabolites-snp-numbers-cap) **Distribution of the number of metabolites individual SNPs were associated with**. The majority of the `r nrow(n_SNPS)` identified SNPs were associated with 1 metabolite. One SNP was associated with 33 out of a total 53 metabolites. Bin size = 1.

(ref:mediation-figure-metabolites-snp-numbers-scap) Distribution of the number of metabolites individual SNPs were associated with

```{r mediation-figure-metabolites-snp-numbers, echo=FALSE, out.width='100%', fig.cap='(ref:mediation-figure-metabolites-snp-numbers-cap)', fig.scap='(ref:mediation-figure-metabolites-snp-numbers-scap)'}
ggplot(freq_SNP, 
       aes(x = count)) + 
  geom_histogram(binwidth = 1, alpha = 1,
                 color = discrete_wes_pal[1],
                 fill = discrete_wes_pal[1]) + 
  xlab("Total number of metabolites an individual SNP is associated with") + ylab("Frequency") +
  theme_cowplot()
```

```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
data <- read.table("../../007_metabolites_outcomes/analysis/003_metabolite_endometrial/mr_results_formatted_associated_metabolites.txt", header = T, sep = "\t")
data <- select(data, c("metabolite", "ng_anno_raw.label", "outcome", "nsnp", "b", "se", "pval", "method"))
data$OR <- exp(data$b)
data$lower_ci <- data$OR - (1.96 * data$se)
data$upper_ci <- data$OR + (1.96 * data$se)
data <- subset(data, method == "Inverse variance weighted (multiplicative random effects)")
valine <- subset(data, metabolite == "val")
```

A total of `r length(unique_metabolites)` metabolites showed evidence of association for at least one outcome (Figure \@ref(fig:mediation-figure-forestplot-adiposity-metabolites-cancer)). Valine was the only metabolite found to reduce the risk of endometrial cancer (OR of endometrial cancer per SD unit increase in valine = `r round(valine$OR[1],2)`; 95% CI = `r round(valine$lower_ci[1],2)`--`r round(valine$upper_ci[1],2)`; p-value = `r round(valine$pval[1],2)`). The largest effect was found for triglycerides in small VLDL, which increased the odds of non-endometrioid cancer by 1.8 (95% CI = 1.4--2.1; p-value = 0.001). The largest effect on endometrioid cancer was for phospholipids in very large HDL (OR 1.16; 95% CI = 1.02--1.31; p-value = 0.04), while the largest effect on overall endometrial cancer was for triglycerides in very large HDL (OR = 1.11; 95% CI = 1.00--1.22; p-value = 0.06). \par

Of the 5 metabolites with evidence of association with endometrial cancer, endometrioid cancer, and/or non-endometrioid cancer, only triglycerides in very large HDL was associated with BF in the previous analysis conducted in this Chapter and in observational (Chapter \@ref(observational)) and MR (Chapter \@ref(MR)) analyses. The remaining 4 metabolites were not associated with BF in any analysis, but were all associated with BMI and WHR in the previous analysis here and in observational (Chapter \@ref(observational)) and MR (Chapter \@ref(MR)) analyses. As all 5 metabolites showed evidence of association with a measure of adiposity and endometrial cancer, all were taken forward for MVMR analysis. \par


<!--
```{r mediation-table-adiposity-metabolites-cancer, eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
table <- data.frame(Metabolite = c("Phospholipids in very large HDL", "Triglycerides in small VLDL", "Triglycerides in very large HDL", "Triglycerides in very small VLDL", "Valine"),
                    BMI = c("Yes", "Yes", "No", "Yes", "Yes"),
                    WHR = c("Yes", "Yes", "No", "Yes", "Yes"),
                    BF = c("No", "No", "Yes", "No", "No"))

knitr::kable(table, longtable = T, booktabs = T, format = "latex", escape = F,
    caption = 'Metabolites associated with endometrial cancer and whether they were associated with an adiposity measure', row.names = F,
    col.names = c("", "BMI", "WHR", "BF")) %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "repeat_header"), position = "center")
```
-->


(ref:mediation-figure-forestplot-metabolites-cancer-cap) **Two-sample MR: Effect of metabolites on endometrial cancer**. Forest plot shows odds ratio (OR) and 95% confidence interval for metabolites associated with BMI, WHR, and/or BF on endometrial cancer, endometrioid cancer, and non-endometrioid cancer. The main analysis (IVW multiplicative random effects (MRE)) is presented alongside sensitivity analyses (weighted median, weighted mode, MR-Egger). 

(ref:mediation-figure-forestplot-metabolites-cancer-scap) Two-sample MR: Effect of metabolites on endometrial cancer

```{r mediation-figure-forestplot-metabolites-cancer, echo=FALSE, out.width='100%', fig.cap='(ref:mediation-figure-forestplot-metabolites-cancer-cap)', fig.scap='(ref:mediation-figure-forestplot-metabolites-cancer-scap)'}
knitr::include_graphics("../../007_metabolites_outcomes/analysis/003_metabolite_endometrial/figures/forestplot.pdf")
```

### Two-sample multivariable Mendelian randomization: intermediate effects of adiposity associated metabolites on endometrial cancer
```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
# data 
adiposity_metab <- read.table("../../007_metabolites_outcomes/analysis/002_adiposity_metabolite/001_mr_results.txt", header = T, sep = "\t")
adiposity_metab <- select(adiposity_metab, c("exposure", "ng_anno_raw.label", "metabolite", "UKB_b", "UKB_se", "UKB_p"))
colnames(adiposity_metab) <- c("exposure", "ng_anno_raw.label", "metabolite", "b", "se", "pval")
adiposity_metab_svldltg <- subset(adiposity_metab, metabolite == "svldltg")
adiposity_metab_xsvldltg <- subset(adiposity_metab, metabolite == "xsvldltg")

bf_metab <- read.table("../../007_metabolites_outcomes/analysis/002_adiposity_metabolite/bf/mr_results_formatted.txt", header = T, sep = "\t")
bf_metab <- subset(bf_metab, method == "Inverse variance weighted (multiplicative random effects)")
bf_metab <- select(bf_metab, c("exposure", "ng_anno_raw.label", "metabolite", "b", "se", "pval"))
bf_metab$exposure <- "bf"
bf_metab_svldltg <- subset(bf_metab, metabolite == "svldltg")
bf_metab_xsvldltg <- subset(bf_metab, metabolite == "xsvldltg")

adiposity_metab_svldltg <- rbind(adiposity_metab_svldltg,bf_metab_svldltg)
adiposity_metab_svldltg$lower_ci <- adiposity_metab_svldltg$b - (1.96 * adiposity_metab_svldltg$se)
adiposity_metab_svldltg$upper_ci <- adiposity_metab_svldltg$b + (1.96 * adiposity_metab_svldltg$se)

adiposity_metab_xsvldltg <- rbind(adiposity_metab_xsvldltg,bf_metab_xsvldltg)
adiposity_metab_xsvldltg$lower_ci <- adiposity_metab_xsvldltg$b - (1.96 * adiposity_metab_xsvldltg$se)
adiposity_metab_xsvldltg$upper_ci <- adiposity_metab_xsvldltg$b + (1.96 * adiposity_metab_xsvldltg$se)


```
Of the 5 metabolites for which there was causal evidence of an effect of at least one measure of adiposity and an effect on endometrial cancer, two had consistent positive directions of effect with all measures of adiposity and endometrial cancer: triglycerides in small VLDL and triglycerides in very small VLDL. For triglycerides in small VLDL, the strongest effect of adiposity was found for WHR (SD unit increase in metabolite per SD increase in adiposity measure = `r round(max(adiposity_metab_svldltg$b),2)`; 95% CI = `r round(adiposity_metab_svldltg$lower_ci[2],2)`--`r round(adiposity_metab_svldltg$upper_ci[2],2)`; p-value = `r round(adiposity_metab_svldltg$pval[2],2)`); WHR also had the strongest effect on triglyverides in very small VLDL (beta = `r round(max(adiposity_metab_xsvldltg$b),2)`; 95% CI = `r round(adiposity_metab_xsvldltg$lower_ci[2],2)`--`r round(adiposity_metab_xsvldltg$upper_ci[2],2)`; p-value = `r round(adiposity_metab_xsvldltg$pval[2],2)`). BMI (effect on small VLDL = `r round(adiposity_metab_svldltg$b[1],2)`; effect on very small VLDL = `r round(adiposity_metab_xsvldltg$b[1],2)`) and BF (effect on small VLDL = `r round(adiposity_metab_svldltg$b[3],2)`; effect on very small VLDL = `r round(adiposity_metab_xsvldltg$b[3],2)`) both had positive effects on triglycerides in small VLDL and very small VLDL, however confidence intervals overlapped the null (Table \@ref(tab:mediation-table-mvmr-adiposity-metabolites)). Of the remaining three metabolites, all three adiposity measures were found to decrease phospholipids in very large HDL and triglycerides in very large HDL, while an increase in these metabolites was associated with an increase in all three endometrial cancer outcomes. The remaining metabolite, valine, was found to be increased by all three adiposity measures, however increased valine was associated with a decreased risk of all three endometrial cancer outcomes. As such, triglycerides in small VLDL and triglycerides in very small VLDL were taken forward for MVMR analysis.

```{r mediation-table-mvmr-adiposity-metabolites, eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
table <- rbind(adiposity_metab_svldltg, adiposity_metab_xsvldltg)
table$b <- round(table$b,2)
table$lower_ci <- round(table$lower_ci,2)
table$upper_ci <- round(table$upper_ci,2)
table$pval <- round(table$pval,2)
table$exposure <- toupper(table$exposure)
table <- table[,c("exposure", "ng_anno_raw.label", "b", "lower_ci", "upper_ci", "pval")]

knitr::kable(table, longtable = T, booktabs = T, format = "latex", escape = F,
    caption = 'Two-sample Mendelian randomization: Effect of adiposity measures on triglycerides in small and very small VLDL', row.names = F,
    col.names = c("", "", "Effect", "Lower CI", "Upper CI", "p-value")) %>%
  kable_styling(latex_options = c("striped", "HOLD_position"), position = "center") %>%
  kableExtra::footnote(general = "Effect estimates are given as SD unit increase in metabolite per SD unit increase in adiposity measure. Metabolite labels are presented with their originally measured units", threeparttable = T, general_title = "", footnote_as_chunk = T)
```

```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
data <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/mvmr_results_formatted.txt", header = T, sep = "\t")
data <- subset(data, method == "Two Sample MR")
data <- data[c(10:15),]
table <- data[,c("exposure", "outcome", "OR", "lower_ci", "upper_ci", "pval")]
table$exposure[table$exposure == "SVLDLTG"] <- "Triglycerides in small VLDL (mmol/l)"
table$exposure[table$exposure == "XSVLDLTG"] <- "Triglycerides in very small VLDL (mmol/l)"
table$OR <- round(table$OR,2)
table$lower_ci <- round(table$lower_ci,2)
table$upper_ci <- round(table$upper_ci,2)
table$pval <- round(table$pval,2)
```
The effect of both triglycerides in small (OR per SD unit increase in metabolite = `r table$OR[3]`; 95% CI = `r table$lower_ci[3]`--`r table$upper_ci[3]`; p-value = `r table$pval[3]`) and very small VLDL (OR = `r table$OR[6]`; 95% CI = `r table$lower_ci[6]`--`r table$upper_ci[6]`; p-value = `r table$pval[6]`) was strongest for non-endometrioid cancer. Both metabolites had positive effects on endometrioid (OR small VLDL = `r table$OR[2]`; OR very small VLDL = `r table$OR[5]`) and overall endometrial cancer (OR small VLDL = `r table$OR[1]`; OR very small VLDL = `r table$OR[4]`) with highly similar effect sizes. However, effects were smaller than for non-endometrioid cancer and confidence intervals overlapped the null (Table \@ref(tab:mediation-table-mvmr-metabolites-endometrial)). \par

```{r mediation-table-mvmr-metabolites-endometrial, eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
knitr::kable(table, longtable = T, booktabs = T, format = "latex", escape = F,
    caption = 'Two-sample Mendelian randomization: Effect of triglycerides in small and very small VLDL on endometrial cancer', row.names = F,
    col.names = c("", "", "OR", "Lower CI", "Upper CI", "p-value")) %>%
  kable_styling(latex_options = c("striped", "HOLD_position"), position = "center") %>%
  kableExtra::footnote(general = "Effect estimates are given as the odds (OR) of endometrial cancer per SD unit increase in metabolite. Metabolite labels are presented with their originally measured units", threeparttable = T, general_title = "", footnote_as_chunk = T)
```

```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
data <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/mvmr_results_formatted.txt", header = T, sep = "\t")
data$OR <- round(data$OR,2)
data$lower_ci <- round(data$lower_ci,2)
data$upper_ci <- round(data$upper_ci,2)

mr <- subset(data, method == "Two Sample MR")
mvmr <- subset(data, method == "Multivariable MR")

mvmr_bmi <- subset(mvmr, exposure == "BMI")
mvmr_bf <- subset(mvmr, exposure == "BF")
mvmr_whr <- subset(mvmr, exposure == "WHR")


mvmr_metab_bf <- subset(mvmr, adjusted == "BF")

mr_bmi <- subset(mr, exposure == "BMI")
mr_bf <- subset(mr, exposure == "BF")
mr_whr <- subset(mr, exposure == "WHR")
mr_svldltg <- subset(mr, exposure == "SVLDLTG")
mr_xsvldltg <- subset(mr, exposure == "XSVLDLTG")




endometrial <- subset(data, outcome == "Endometrial cancer")
endometrial_svldltg <- subset(endometrial, exposure == "SVLDLTG")
endonmetroid <- subset(data, outcome == "endometroid")
non_endometrioid <- subset(data, outcome == "Non-endometroid")
```
In MVMR analysis, the effect of BMI on overall endometrial cancer was highly similar after adjustment for both metabolites: OR per SD unit increase in BMI adjusted for triglycerides in small VLDL = `r mvmr_bmi$OR[1]`; 95% CI = `r mvmr_bmi$lower_ci[1]`--`r mvmr_bmi$upper_ci[1]`; p-value = 5.18 x 10^-9^; OR per SD unit increase in BMI adjusted for triglycerides very small VLDL = `r mvmr_bmi$OR[4]`; 95% CI = `r mvmr_bmi$lower_ci[4]`--`r mvmr_bmi$upper_ci[4]`; p-value = 7.26 x 10^-8^. These results were highly similar to the unadjusted (i.e. two-sample MR) effect of BMI on endometrial cancer (OR per SD unit increase in BMI = `r mr_bmi$OR[1]`; 95% CI = `r mr_bmi$lower_ci[1]`--`r mr_bmi$upper_ci[1]`; p-value = 7.47 x 10^-15^). A similar pattern of association was found across endometrioid and non-endometrioid cancer, with highly similar effect sizes and confidence intervals after adjustment for each metabolite and when comparing effect size and confidence intervals with the unadjusted effects (Figure \@ref(fig:mediation-figure-forestplot-adiposity-metabolites-cancer)). When looking at the effect of metabolites on all endometrial cancer outcomes after adjustment for BMI, there was little difference with effect size in comparison to the unadjusted effect, however confidence intervals were generally wider in the adjusted estimates. For non-endometrioid cancer, however, the adjusted effect size was larger than the unadjusted effect size for both metabolites, but confidence intervals overlapped. Given the similarity between unadjusted and adjusted effects, it is unlikely that either metabolite has a role in mediating the effects of BMI on overall endometrial, endometrioid, and non-endometrioid cancer. \par

\blandscape
(ref:mediation-figure-forestplot-adiposity-metabolites-cancer-cap) **Multivariable MR: Effect of adiposity and metabolites on endometrial cancer**. Forest plot shows odds ratio and 95% confidence interval for: the two-sample MR analyses described previously and the two-sample multivariable MR results for the effect of adiposity measures adjusted for metabolites and metabolites adjusted for adiposity measures on endometrial (left), endometrioid (middle) and non-endometrioid cancer (right). Points and confidence intervals are coloured for the variable they represent in the two-sample MR and for the adjusted variable in the multivariable MR, e.g. BMI is coloured orange and any metabolite effect adjusted for BMI is coloured orange also. An inverse variance weighted model was used. BMI = body mass index; BF = body fat percentage; WHR = waist hip ratio; SVLDLTG = triglycerides in small VLDL; XSVLDLTG = triglycerides in very small VLDL.

(ref:mediation-figure-forestplot-adiposity-metabolites-cancer-scap) Multivariable MR: Effect of adiposity and metabolites on endometrial cancer

```{r mediation-figure-forestplot-adiposity-metabolites-cancer, echo=FALSE, out.width='100%', fig.cap='(ref:mediation-figure-forestplot-adiposity-metabolites-cancer-cap)', fig.scap='(ref:mediation-figure-forestplot-adiposity-metabolites-cancer-scap)'}
knitr::include_graphics("../../007_metabolites_outcomes/analysis/004_mvmr/figures/forestplot.pdf")
```
\elandscape

For the effect of BF and WHR on endometrial and endometrioid cancer, a similar pattern of association to that of BMI was seen, with effect sizes and confidence intervals highly similar after adjustment with both metabolites. For example, the effect of WHR on endometrial cancer adjusted for triglycerides in small VLDL was `r mvmr_whr$OR[1]` (95% CI = `r mvmr_whr$lower_ci[1]`--`r mvmr_whr$upper_ci[1]`; p-value = `r mvmr_whr$pval[1]`) whereas after adjustment for triglycerides in very small VLDL the OR was `r mvmr_whr$OR[4]` (95% CI = `r mvmr_whr$lower_ci[4]`--`r mvmr_whr$upper_ci[4]`; p-value = `r mvmr_whr$pval[4]`). For both BF and WHR, the adjusted effects had much wider confidence intervals than the unadjusted effects; for BF, adjustment for either metabolite resulted in confidence intervals which crossed the null. For WHR, confidence intervals crossed the null in unadjusted and adjusted analyses. When looking at the metabolites effects on endometrial and endometrioid cancer after adjustment for BF or WHR, there is a similar pattern of association to when adjusting for BMI, with similar sized effect sizes and confidence intervals which overlapped the null. The exception was for the effect of triglycerides in small VLDL on overall endometrial cancer, which, when adjusted for BF (OR = `r mvmr_metab_bf$OR[1]`; 95% CI = `r mvmr_metab_bf$lower_ci[1]`--`r mvmr_metab_bf$upper_ci[1]`; p-value = `r mvmr_bf$pval[1]`) did not cross the null unlike in the unadjusted analysis (OR = `r mr_svldltg$OR[1]`; 95% CI = `r mr_svldltg$lower_ci[1]`--`r mr_svldltg$upper_ci[1]`; p-value = `r mr_svldltg$pval[1]`). \par

For non-endometrioid cancer, the pattern of association for BF and WHR was different to that of BMI. Both BF and WHR adjusted for triglycerides in small VLDL resulted in directions of effect which were opposite to the unadjusted estimates; BF adjusted OR = `r mvmr_bf$OR[3]` (95% CI = `r mvmr_metab_bf$lower_ci[3]`--`r mvmr_metab_bf$upper_ci[3]`; p-value = `r mvmr_bf$pval[3]`); BF unadjusted OR = `r mr_bf$OR[3]` (95% CI = `r mr_bf$lower_ci[3]`--`r mr_bf$upper_ci[3]`; p-value = `r mr_bf$pval[3]`); WHR adjusted OR = `r mvmr_whr$OR[3]` (95% CI = `r mvmr_whr$lower_ci[3]`--`r mvmr_whr$upper_ci[3]`; p-value = `r mvmr_whr$pval[3]`); WHR unadjusted OR = `r mr_whr$OR[3]` (95% CI = `r mr_whr$lower_ci[3]`--`r mr_whr$upper_ci[3]`; p-value = `r mr_whr$pval[3]`). Confidence intervals overlapped the null and the unadjusted estimates for BF and WHR. When looking at the effect of triglycerides in small and very small VLDL on non-endometrioid cancer, adjustment for BF and WHR led to a greater increased risk of non-endometrioid cancer than was found in the unadjusted analysis. Confidence intervals for triglycerides in small VLDL were similar in width, and overlapped, to the unadjusted estimate. Confidence intervals for triglycerides in very small VLDL were much wider in adjusted analyses compared to unadjusted analysis. \par

Overall, BMI, WHR, and BF adjusted for either metabolite led to an increased risk of overall endometrial and endometrioid cancer. While BMI adjusted for either metabolite increased the risk of non-endometrioid cancer, BF reduced the risk of non-endometrioid cancer as did WHR when adjusted for triglycerides in small VLDL. The effect of WHR on non-endometrioid cancer after adjusting for triglycerides in very small VLDL, although positive, was attenuated compared to the unadjusted effect. Confidence intervals for all adjusted analyses overlapped with confidence intervals for respective unadjusted analyses. For triglycerides in small VLDL, effect sizes were broadly consistent across adjusted and unadjusted analyses with overlapping confidence intervals; the exception being for the effect on non-endometroid cancer, where effect sizes increased compared to the unadjusted effect size. A similar picture is apparent for triglycerides in very small VLDL. \par

Of particular note is the effect of WHR adjusted for both metabolites and both metabolites adjusted for WHR on non-endometrioid cancer; WHR and both metabolites were associated with non-endometrioid cancer in the unadjusted analysis, however, after adjusting WHR for either metabolite, the effect of WHR on non-endometrioid cancer attenuated to the null while the effect of the metabolites adjusted for WHR remained consistent with the unadjusted analysis. A similar picture is seen for the effect of BF adjusted for both metabolites and both metabolites adjusted for BF on non-endometrioid cancer; the effect of BMI adjusted for both metabolites shows a smaller attenuation to the null. These results would suggest the effect of WHR (and to a lesser extent BF) on non-endometrioid cancer is either mediated by triglycerides in small and very small VLDL or there is considerable pleiotropy. A table of the full results is available on [GitHub](https://github.com/mattlee821/000_thesis/blob/master/index/data/mediation/results/004_mvmr/mvmr_results_formatted.txt). \par

#### Sensitivity analysis
Instrument strength, estimated using the F-statistic, can give an estimate of weak instrument bias in MR analyses. In general, an F-statistic of $\geq$ 10 is considered sufficiently strong that there is not substantial weak instrument bias[@Burgess2011; @Burgess2015b], in a single sample setting, the bias is towards the observational estimate, whereas in a two-sample setting, the bias is towards the null. Weak instrument bias was estimated using a generalized version of Cochran's Q[@Sanderson2019b]. F-statistics were $\geq$ 10 for all but triglycerides in small VLDL adjusted for BMI (F = 9) and WHR (F = 7) (Table \@ref(tab:mediation-table-fstatistics)). F-statistics in MVMR analysis were lower than those associated with the instruments used in the two-sample MR analysis, for example BMI in two-sample MR had an F-statistic of 66 while after adjustment for both metabolites this dropped to 54. \par

```{r mediation-table-fstatistics, eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
data <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/mvmr_results.txt", header = T, sep = "\t")
data <- data[!duplicated(data$f_stat.exposure1),]

metab <- read.table("../../007_metabolites_outcomes/analysis/003_metabolite_endometrial/exposure_data.txt", header = T, sep = "\t")
svldltg <- subset(metab, exposure == "S_VLDL_TG_int_imputed.txt_snps.txt")
svldltg$f_stats <- (svldltg$b / svldltg$se)^2 
svldltg$mean_fstat <- mean(svldltg$f_stats)
xsvldltg <- subset(metab, exposure == "XS_VLDL_TG_int_imputed.txt_snps.txt")
xsvldltg$f_stats <- (xsvldltg$b / xsvldltg$se)^2 
xsvldltg$mean_fstat <- mean(xsvldltg$f_stats)

adiposity <- read.table("../../007_metabolites_outcomes/analysis/001_adiposity_endometrial/exposure_data.txt", header = T, sep = "\t")
bmi <- subset(adiposity, exposure == "Locke BMI EU sex combined 77 SNPs clumped")
whr <- subset(adiposity, exposure == "Shungin WHR EU sex combined 26 SNPs")
bf <- subset(adiposity, exposure == "Lu BF EU sex combined 5 SNPs")

table <- data.frame(exposure = c("SVLDLTG", "XSVLDLTG", "BMI", "WHR", "BF", "Two-sample MR F"),
                    BMI = c(round(data$f_stat.exposure1[1],0), round(data$f_stat.exposure1[2],0),"","","", 
                            round(bmi$mean_fsta[1],0)),
                    
                    WHR = c(round(data$f_stat.exposure1[3],0), round(data$f_stat.exposure1[4],0),"","","", 
                            round(whr$mean_fsta[1],0)),
                    
                    BF = c(round(data$f_stat.exposure1[5],0), round(data$f_stat.exposure1[6],0),"","","", 
                           round(bf$mean_fsta[1],0)),
                    
                    SVLDLTG = c("","",round(data$f_stat.exposure2[1],0),round(data$f_stat.exposure2[2],0),round(data$f_stat.exposure2[3],0),
                                round(svldltg$mean_fsta[1],0)),
                    
                    XSVLDLTG = c("","",round(data$f_stat.exposure2[4],0),round(data$f_stat.exposure2[5],0),round(data$f_stat.exposure2[6],0),
                                 round(xsvldltg$mean_fsta[1],0)))

knitr::kable(table, longtable = T, booktabs = T, format = "latex", escape = F,
    caption = 'F-statistics for adjusted exposures used in multivariable MR analyses', row.names = F,
    col.names = c("", "BMI", "WHR", "BF", "SVLDLTG", "XSVLDLTG")) %>%
  kable_styling(latex_options = c("striped", "HOLD_position"), position = "center") %>%
  kableExtra::footnote(general = "F-statistics are presented for each exposure (column) and the adjusted (row) variable, e.g. BMI adjusted for SVLDLTG (column 1 row 1) = 54. The mean F-statistic for instruments used in the two-sample MR are also presented for each exposure (column). BMI = body mass index; WHR = waist hip ratio; BF = body fat percentage; SVLDLTG = Triglycerides in small VLDL; XSVLDLTG = Triglycerides in very small VLDL.", threeparttable = T, general_title = "", footnote_as_chunk = T)
```

```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
data <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/mvmr_sensitivity_results_formatted.txt", header = T, sep = "\t")
data <- data[!duplicated(data$Qstat),]
sig <- subset(data, Qpval <= 0.05)
```
Horizontal pleiotropy, whereby the effect of the instrument on the outcome is not exclusively through the exposure, was estimated using a modified form of Cochran's Q[@Sanderson2019b]. Of the `r nrow(data)` tests, `r nrow(sig)` showed evidence of horizontal pleiotropy (p-value < $0.05$). All 6 analyses investigating associations with non-endometrioid cancer, and one analysis on endometrial cancer showed weak evidence of pleiotropy (p-value > $0.05$). On the whole, evidence of pleiotropy was strongest when instrumenting triglycerides in very small VLDL (Table \@ref(tab:mediation-table-qstatistics)). These results highlight the potential violation of the independence and exclusion restriction assumptions for analyses investigating adjusted effects on overall endometrial and endometrioid cancer. \par

```{r mediation-table-qstatistics, eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
data <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/mvmr_sensitivity_results_formatted.txt", header = T, sep = "\t")
data <- data[!duplicated(data$Qstat),]
data <- data[,c("group", "outcome", "Qstat", "Qpval")]
data <- data[order(data$Qpval),]
data$Qstat <- round(data$Qstat, 0)
data$Qpval <- round(data$Qpval, 4)
data$group[data$group == "bf_svldltg"] <- "BF & SVLDLTG"
data$group[data$group == "bf_xsvldltg"] <- "BF & XSVLDLTG"
data$group[data$group == "bmi_svldltg"] <- "BMI & SVLDLTG"
data$group[data$group == "bmi_xsvldltg"] <- "BMI & XSVLDLTG"
data$group[data$group == "whr_svldltg"] <- "WHR & SVLDLTG"
data$group[data$group == "whr_xsvldltg"] <- "WHR & XSVLDLTG"
data <- droplevels(data)
knitr::kable(data, longtable = T, booktabs = T, format = "latex", escape = T,
             caption = 'Multivariable MR Q statistics', row.names = F,
             col.names = c("Instrument", "Outcome", "Q", "P-value")) %>%
  kable_styling(latex_options = c("striped", "HOLD_position"), position = "center") %>%
  kableExtra::footnote(general = "Table is ordered by smallest to largest p-value. BMI = body mass index; WHR = waist hip ratio; BF = body fat percentage; SVLDLTG = Triglycerides in small VLDL; XSVLDLTG = Triglycerides in very small VLDL; Q = Cochran's.", threeparttable = T, general_title = "", footnote_as_chunk = T)
```

## Discussion
```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
# data 
data <- read.table("../../007_metabolites_outcomes/analysis/001_adiposity_endometrial/001_MR_results.txt", header = T, sep = "\t")
data$group[data$exposure == "Locke BMI EU sex combined 77 SNPs clumped"] <- "BMI"
data$group[data$exposure == "Shungin WHR EU sex combined 26 SNPs"] <- "WHR"
data$group[data$exposure == "Lu BF EU sex combined 5 SNPs"] <- "BF"
data$outcome_label[data$outcome == "Endometrial cancer (endometrioid histology) || id:ebi-a-GCST006465"] <- "Endometrioid"
data$outcome_label[data$outcome == "Endometrial cancer (Non-endometrioid histology) || id:ebi-a-GCST006466"] <- "Non-endometrioid"
data$outcome_label[data$outcome == "Endometrial cancer || id:ebi-a-GCST006464"] <- "Endometrial cancer"
data$method[data$method == "Inverse variance weighted (multiplicative random effects)"] <- "IVW-MRE"

data <- subset(data, method == "IVW-MRE")
bmi <- subset(data, group == "BMI")
whr <- subset(data, group == "WHR")
bf <- subset(data, group == "BF")
```
In this Chapter, the potential intermediary effect of metabolites in the association between adiposity and endometrial cancer was investigated. Two metabolites, triglycerides in small and very small VLDL, with evidence for a causal relationship with adiposity measures and endometrial cancer, were included in MVMR analyses. There was evidence of for an intermediate effect of triglycerides in small VLDL and triglycerides in very small VLDL on the effect of WHR on non-endometrioid cancer. There was weaker evidence for a similar intermediate effect of triglycerides in small and very small VLDL on the effect of BF on non-endometrioid cancer. Whether the effect of WHR (and BF) on non-endometrioid cancer was mediated by triglycerides in small and very small VLDL was unclear; sensitivity analysis did not indicate that effects were due to horizontal pleiotropy, however weak instruments may have biased the results for the effect of triglycerides in small VLDL adjusted for WHR on non-endometrioid cancer towards the null. There was weak evidence for an intermediate effect of both metabolites on endometrioid and overall endometrial cancer across adiposity measures. Results here also provide strong evidence for a causal effect of BMI on endometrial cancer (OR per normalized SD unit increase in BMI = `r round(bmi$OR[1],2)`; 95% CI = `r round(bmi$lower_ci[1],2)`--`r round(bmi$upper_ci[1],2)`; p-value = 1.74 x 10^-15^; (Table \@ref(tab:mediation-table-adiposity-cancer)). This was consistent with previous MR results[@Gharahkhani2019; @Painter2016; @Yarmolinsky2019] presented as part of Chapter \@ref(systematic-review) (OR = 1.57; 95% CI = 1.11  2.22; p-value = 0.01) and observational results reported in the literature by Bhaskaran et al. (2104; OR = 1.62; 95% CI = 1.56  1.69; p-value = 1 x 10^-4^)[@Bhaskaran2014]. \par

Previous observational work has found increased triglycerides to be associated with an increased risk of endometrial cancer[@Lindemann2009]. The effect increased in a dose response manner and persisted after adjusting for BMI and other potential confounders. Similar results have been found elsewhere[@Ulmer2009; @Trabert2015], including associations between increasing triglycerides and advancing tumour stage[@Luo2019]. However, results elsewhere have also shown weak evidence for an association between triglycerides and endometrial cancer after adjusting for BMI[@Cust2007]. There is some evidence to suggest individual triglyceride metabolites, such as myristic acid (a component of the triglyceride trimyristin[@NationalCenterforBiotechnologyInformation2021]), are associated with endometrial cancer development[@Lindemann2009]. However, here are few studies focussing solely on the effects of specific triglycerides on endometrial cancer, as those discussed focussed primarily on triglycerides as a class rather than specific lipoprotein compositions. There is evidence that metabolites within a class may not follow the pattern of association as the class itself[@Corbin2020], e.g. VLDL may be associated with a decreased risk of endometrial cancer, but triglycerides in small VLDL is associated with an increase in endometrial cancer risk. Additionally, it is reasonable to expect that the properties of specific metabolites are exhibited differently in different tissues and cells around the body[@VanderHeiden2009; @DeBerardinis2012; @Zhu2019; @Pavlova2016]. It is therefore hard to compare results here with those from previous analyses. Results here suggest there is an increasing effect of triglycerides on endometrial cancer risk, but that this is likely to be specific to non-endometrioid cancer, and specific to the alignment of triglycerides with small and very small VLDL, which has not been reported in the literature. Instead, associations have focussed on overall endometrial cancer risk. \par

Alongside triglycerides in small and very small VLDL, 3 other metabolites showed evidence of association with endometrial cancer. Increased phospholipids in very large HDL and triglycerides in very large HDL were associated with an increased risk of endometrial, endometrioid, and non-endometrioid cancer. There is some evidence for an increasing effect of phospholipids and triglycerides on endometrial cancer risk[@Raffone2020] but whether this is specific to very large HDL composition is unclear as studies have not focussed on individual metabolites. Valine was also associated with endometrial, endometrioid, and non-endometrioid cancer risk. Previous studies have reported increased valine to be associated with endometrial cancer risk[@Raffone2020]. In two-sample MR analysis here, BMI and WHR were associated with an increase in valine, which has been proposed as a potential intermediate in the association between adiposity and endometrial cancer[@Kliemann2021]. However, in two-sample MR analysis here, valine was associated with a decreased risk of endometrial, endometrioid, and non-endometrioid cancer. This protective effect could be due to metabolic reprogramming of cancer cells which can utilise branched-chain amino acids, such as valine, as alternative fuel sources[@Lieu2020; @Green2016]. \par

When comparing two-sample MR (unadjusted) and two-sample MVMR (adjusted) effect estimates for the association of adiposity measures, there was little change in effect size and confidence intervals overlapped for effects on overall and endometrioid cancer risk. For non-endometrioid cancer risk, the effect of all three adiposity measures, for which confidence intervals did not cross the null in the unadjusted analysis (except for BF), crossed the null in adjusted analyses. This may be reflective of reduced power given the smaller number of cases for non-endometrioid cancer (N = 1,230) as opposed to endometrioid (N = 8,758) and overall endometrial cancer (N = 12,906). For metabolites, when comparing the unadjusted and adjusted effect estimates, effect sizes and confidence intervals were generally larger in the adjusted analysis for all endometrial cancer outcomes. Although in some instances, MVMR can increase power[@Burgess2015b], MVMR is generally considered to be less powered than two-sample MR. The observed decreased precision and larger effect sizes in adjusted analyses may be a result of weak instrument bias, especially for triglycerides in small VLDL adjusted for BMI and WHR. But it may also reflect a true causal association or a highly pleiotropic environment, especially for analyses of the effect on endometrioid and endometrial cancer, where evidence of horizontal pleiotropy was likely high. \par

Previous observational and MR work has found similar effects to those found here. In one study, observational and MR results indicated an association between BMI and endometrial cancer but not WHR and endometrial cancer[@Painter2016]. Additional studies using MR have found consistent effects[@Gharahkhani2019; @Yarmolinsky2019]. There is further observational evidence for associations between BMI and endometrial cancer, as well as WHR, waist circumference, and waist to height ratio[@Barberio2019]. Observational investigations have highlighted links between BMI and both endometrioid and non-endometrioid[@Gates2006; @Bjrge2007; @Crosbie2010; @Yang2013; @Setiawan2013; @Aune2015a; @Gao2018], but there has been a lack of genetic data on both subtypes in large, well-powered studies to enable MR investigations. Additionally, studies have predominantly focussed on BMI with some focus on measures of deposition such as waist circumference (WC) and WHR, but as yet very little work using an absolute measure of adiposity such as BF. Here, investigation of both subtypes and multiple measures of adiposity was possible. MR results were consistent with those found in the aforementioned observational studies. This consistency was similar in the strength of effects, with a stronger effect observed for endometrioid cancer compared to non-endometrioid (though confidence intervals overlapped). Of note is the association found for WHR and non-endometrioid cancer, which has not previously been reported. \par

A prominent strength of this work was the breadth of metabolomics data used here and in previous Chapters. Metabolites used in MVMR analyses here, were selected based on evidence from prior observational (Chapter \@ref(observational)) and MR analyses (Chapter \@ref(MR)) for causal relationships with measures of adiposity. In Chapter \@ref(observational), the metabolic profile of BMI, WHR, and BF was investigated using the Avon Longitudinal Study of Parents and Children (ALSPAC). The effect of adiposity measures on numerous metabolites was robust after accounting for a number of potential confounders such as smoking status, diet, and physical activity level. In Chapter \@ref(MR), the metabolic profile of BMI, WHR, and BF was investigated in a causal framework. Effects identified in the previous observational analysis, as well as in previously published studies, was replicated in two independent studies. Finally, in this Chapter, replication of the causal effects of adiposity on the metabolic profile was performed using the largest independent data set available, UK Biobank. Additionally, replication of the causal effect of BMI on endometrial cancer, as obtained from a meta-analysis in Chapter \@ref(systematic-review), was performed. \par

### Instrumentation
Instrumentation, described briefly for measures of adiposity in Chapter \@ref(MR), is primarily achieved by using either a single genetic instrumental variable or multiple genetic instrumental variables. The choice of instruments for measures of adiposity is generally to use the largest available GWAS and a genome wide p-value threshold of p-value $\leq$ 5 x 10^-8^. This approach was utilised in the Chapter \@ref(MR), however instruments for BMI and WHR were obtained from GWAS which included UK Biobank. UK Biobank is a unique resource with wide application, one of which is as a component of the most recent and largest metabolomics GWAS (unpublished) and endometrial cancer GWAS[@OMara2018], both used here. Overlap between the exposure and outcome in a two-sample MR can bias estimates towards the observational estimate in a manner proportional to the size of the overlap[@Burgess2016] (See limitations section below). As such, instruments for adiposity measures were obtained from GWAS which did not include UK Biobank. In Chapter \@ref(MR), BMI[@Locke2015; @Yengo2018] and WHR[@Shungin2015; @Pulit2019] were instrumented using the largest available GWAS (which included UK Biobank) and the second largest GWAS which was used in analyses in this Chapter, results were highly correlated. As endometrial cancer is a sex-specific condition, this work is limited by the use of sex combined instruments for adiposity, though this does have utility in identifying the general effects of adiposity, especially for metabolites. Instrumentation practices for metabolites are less well established, but have largely followed a similar principle to that described above. Here, a simple instrumentation approach was used for metabolites (p-value $\leq$ 5 x 10^-8^ and LD R^2^ $\leq$ 0.0001 thresholds). This approach could have been strengthened by collapsing metabolites into broader categories[@Bull2020] or by using composite instruments[@Sulc2021]. \par

### Limitations 
In MR, the three main assumptions (SNPs associate with the risk factor of interest, SNPs share no common cause with the outcome, and SNPs do not affect the outcome except through the risk factor) need to be satisfied in order to obtain robust causal estimates. Adiposity instruments used here have been used widely and are robustly associated with their respective phenotypic measures[@Locke2015; @Shungin2015; @Lu2016]. For metabolites, previous work has used a standard approach of identifying SNPs reaching a genome wide p-value threshold (p-value $\leq$ 5 x 10^-8^), which was employed here alongside a stringent LD clumping threshold (R^2^ = 0.001 and 10,000 base window). However, the strength of these instruments in two-sample MVMR was considerably weaker than in two-sample MR, and for triglycerides in small VLDL this was below the nominal threshold of 10. It is likely then that weak instrument bias[@Burgess2011] is a present feature of the MVMR results and is likely to in part explain the decreased precision in confidence intervals. This reduced precision may for example explain why triglycerides in very small VLDL adjusted for WHR is no longer associated with non-endometroid cancer in MVMR versus two-sample MR. In addition to this, instruments reflect a life time exposure and do not take into account change due to lifestyle for instance. \par

It is possible that SNPs associated with metabolites do not conform to the third IV assumption. That is, SNPs associated with metabolites have an effect on the outcome which is not directly through the metabolites. This is of particular concern with metabolites given they are highly inter-correlated and have many have a shared genetic architecture. In this sense, the effect of a metabolite on an outcome could be through a highly correlated second metabolite. Of the 56 and 50 SNPs associated with triglycerides in small and very small VLDL respectively (90 unique SNPs), 16 were shared between them (18%). It is likely both metabolites share SNPs with many other metabolites given that just over half of the 934 identified SNPs for 53 metabolites were associated with just one metabolite and the average number of SNPs associated with a metabolite was 49. \par

In two-sample MR, sensitivity methods (MR-Egger, weighted median, and weighted mode) showed consistent directions of effect for both metabolites with the IVW-MRE method, though the majority of confidence intervals crossed the null. The exception to the consistent direction was triglycerides in small VLDL on endometrioid cancer in MR-Egger analysis which, although the confidence intervals crossed the null, was opposite to the directions of effect of other methods. In MVMR, sensitivity methods such as these have not been developed. Instead, unbalanced horizontal pleiotropy was evaluated using a modified form of Cochran's Q[@Sanderson2019], which found evidence (p-value < 0.05) of unbalanced horizontal pleiotropy for a majority of tests and may therefore bias estimates. \par

An additional implication here is the bias introduced through sample overlap. As discussed in the instrumentation section above, sample overlap can bias estimates towards the observational confounded estimate in a manner proportional to the overlap. In order to minimise overlap, and knowing that metabolite and outcome data included individuals from UK Biobank, exposure instruments were sought from GWAS which did not include UK Biobank. Overlap was therefore limited to the metabolite data endometrial cancer data, specifically the overall endometrial cancer data. For binary outcomes, this bias dues to overlap is specific to the overlap in individuals in the exposure GWAS and those who are cases in the outcome GWAS. In this regard, the number of UK Biobank participants included in the case arm is at most 5% of the total cases. As such, the relative bias in analyses using metabolite and overall endometrial cancer data is at most 0.5%. \par

A key limitation of this work is the use of non-sex-specific instruments for measures of adiposity. A major driver of endometrial cancer, specifically endometrioid cancer, is oestrogen[@WILD2020], which, as a sex hormone, is important in endometrial cell growth. Oestrogen is also involved in the distribution and accumulation of adipose tissue[@Wells2007]. Importantly, adipose tissue is a key source of oestrogen synthesis, particularly post-menopause[@Simpson2003]. There is sexual dimorphism in the accumulation and distribution of adipose tissue that has been highlighted in genetic studies, which found sex-specific SNPs associated with adiposity[@Locke2015; @Shungin2015; @Pulit2019; @Yengo2018; @Hubel2019]. There is also evidence of sex differences in adiposity metabolite associations[@OKeeffe2020]. The use of non-sex-specific adiposity instruments may therefore have biased estimates. This is because, in a two-sample MR the assumption is that the underlying population of the two samples is the same. Violation of this assumption and therefore of the second IV assumption (that instruments do not share a common cause with the outcome) can lead to biased estimates for example from genetic confounding and population structure. \par

In this Chapter, NMR-derived metabolites were used, as with work in Chapter \@ref(observational) and \@ref(MR). Although a relatively large number of metabolites were investigated, they are predominantly lipid based. This leaves a broad array of metabolites that have not been investigated. Mass spectrometry (MS) has investigated many hundreds of metabolites[@Alseekh2021], but unlike NMR derived metabolites (see Wurtz et al. (2014)[@Wurtz2014]), few studies have focused exclusively on the metabolic profile of adiposity using MS-derived measurements. Those that have[@Cirulli2019; @Moore2018; @Perng2020; @Ho2016], have either focussed on case control analyses[@Moore2018], on children[@Perng2020], or included a small number of individuals with repeat measures[@Cirulli2019]. The study by Ho et al. (2016)[@Ho2016] focussed solely on the metabolic profile of adiposity in 2,383 adults and found 69 out of 217 metabolite to be associated with increased BMI, including triglycerides and a number of other associations (e.g., amino acids) identified here. A number of studies have investigated associations between MS-derived metabolites and endometrial cancer. However, these studies have included fewer than 100 cases and have focussed on post-menopausal[@Audet-Delage2018] or obese women[@Njoku2021] only. In the latter case, phospholipids were identified as a biomarker of significance. The study by Audet-Delage et al. (2018)[@Audet-Delage2018], which focussed on post-menopausal women, identified lipid pathways to be most affected by case status. Although numerous SNPs have been associated with MS-derived metabolites[@Shin2014; @Cheng2021; @Lotta2021], to our knowledge no studies have employed MR to investigate metabolic associations with adiposity measures or endometrial cancer. \par

### Conclusion
There were few metabolites that showed evidence of a causal relationship with adiposity measures and were causal for endometrial cancer. Of the few metabolites with evidence for a causal relationship with adiposity and endometrial cancer, there was evidence that triglycerides in small and very small VLDL may play an intermediary role between WHR and non-endometrioid cancer. There was some suggestive evidence for a similar intermediary role between BMI and BF and non-endometrioid cancer. Non-endometrioid cancer is the more aggressive of the two common subtypes of endometrial cancer, and is typically considered oestrogen independent but recent work has shown this is not necessarily the case. There was weak evidence of horizontal pleiotropy in MVMR analyses investigating effects on non-endometrioid cancer compared to endometrioid and overall endometrial cancer. However, this does not rule out the possibility of pleiotropic effects, especially as metabolites are highly intercorrelated and have a shared genetic architecture. Future work to elucidate the intermediary relationship of triglycerides in small and very small VLDL should have two focusses: (i) specific metabolites within the VLDL triglyceride subclass (ii) and wet lab studies, which, when informed by MR analyses, have been fruitful in identifying molecular mechanisms[@Nounu2021]. \par

\newpage





<!--
```{r mediation-table-N-SNP, eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
# adiposity SNPs
adiposity <- read.table("../../007_metabolites_outcomes/analysis/001_adiposity_endometrial/exposure_data.txt", header = T, sep = "\t")
bmi <- subset(adiposity, exposure == "Locke BMI EU sex combined 77 SNPs clumped")
whr <- subset(adiposity, exposure == "Shungin WHR EU sex combined 26 SNPs")
bf <- subset(adiposity, exposure == "Lu BF EU sex combined 5 SNPs")

# metabolite SNPs
metab <- read.table("../../007_metabolites_outcomes/analysis/003_metabolite_endometrial/exposure_data.txt", header = T, sep = "\t")
svldltg <- subset(metab, exposure == "S_VLDL_TG_int_imputed.txt_snps.txt")
svldltg$f_stats <- (svldltg$b / svldltg$se)^2 
svldltg$mean_fstat <- mean(svldltg$f_stats)
xsvldltg <- subset(metab, exposure == "XS_VLDL_TG_int_imputed.txt_snps.txt")
xsvldltg$f_stats <- (xsvldltg$b / xsvldltg$se)^2 
xsvldltg$mean_fstat <- mean(xsvldltg$f_stats)

# mvmr adiposity SNPs
mvmr_bmi_svldltg <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/adiposity/bmi_svldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_bmi_xsvldltg <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/adiposity/bmi_xsvldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_whr_svldltg <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/adiposity/whr_svldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_whr_xsvldltg <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/adiposity/whr_xsvldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_bf_svldltg <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/adiposity/bf_svldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_bf_xsvldltg <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/adiposity/bf_xsvldltg_mvmr_instruments.txt", header = T, sep = "\t")

# mvmr metabolite SNPs
mvmr_svldltg_bmi <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/metabolites/bmi_svldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_svldltg_whr <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/metabolites/whr_svldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_svldltg_bf <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/metabolites/bf_svldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_xsvldltg_bmi <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/metabolites/bmi_xsvldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_xsvldltg_whr <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/metabolites/whr_xsvldltg_mvmr_instruments.txt", header = T, sep = "\t")
mvmr_xsvldltg_bf <- read.table("../../007_metabolites_outcomes/analysis/004_mvmr/metabolites/bf_xsvldltg_mvmr_instruments.txt", header = T, sep = "\t")

# table 
table <- data.frame(a = "N",
                    BMI = nrow(bmi),
                    WHR = nrow(whr),
                    BF = nrow(bf),
                    SVLDLTG = nrow(svldltg),
                    XSVLDLTG = nrow(xsvldltg))

table1 <- data.frame(a = "N",
                    `BMI SVLDLTG` = nrow(mvmr_bmi_svldltg),
                    `BMI XSVLDLTG` = nrow(mvmr_bmi_xsvldltg),
                    `WHR SVLDLTG` = nrow(mvmr_whr_svldltg),
                    `WHR XSVLDLTG` = nrow(mvmr_whr_xsvldltg),
                    `BF SVLDLTG` = nrow(mvmr_bf_svldltg),
                    `BF XSVLDLTG` = nrow(mvmr_bf_xsvldltg),
                    
                    `SVLDLTG BMI` = nrow(mvmr_svldltg_bmi),
                    `SVLDLTG WHR` = nrow(mvmr_svldltg_whr),
                    `SVLDLTG BF` = nrow(mvmr_svldltg_bf),
                    `XSVLDLTG BMI` = nrow(mvmr_xsvldltg_bmi),
                    `XSVLDLTG WHR` = nrow(mvmr_xsvldltg_whr),
                    `XSVLDLTG BF` = nrow(mvmr_xsvldltg_bf))

knitr::kable(table, longtable = T, booktabs = T, format = "latex", escape = F,
    caption = 'Number of SNPs used in the two-sample MR analyses and multivaraibel MR analyses', row.names = F,
    col.names = c("", "BMI", "WHR", "BF", "SVLDLTG", "XSVLDLTG")) %>%
  kable_styling(latex_options = c("striped", "HOLD_position"), position = "center") %>%
  kableExtra::footnote(general = " BMI = body mass idnex; WHR = waist hip ratio; BF = body fat percentage; SVLDLTG = Triglycerides in small VLDL; XSVLDLTG = Triglycerides in very small VLDL.", threeparttable = T, general_title = "", footnote_as_chunk = T)

knitr::kable(table1, longtable = T, booktabs = T, format = "latex", escape = F,
    caption = 'F-statistics for adjusted exposures used in multivariable MR analyses', row.names = F,
    col.names = c("", "SVLDLTG", "XSVLDLTG", "SVLDLTG", "XSVLDLTG", "SVLDLTG", "XSVLDLTG", "BMI","WHR","BF","BMI","WHR","BF")) %>%
  add_header_above(c("", "BMI" = 2, "WHR" = 2, "BF" = 2, "SVLDLTG" = 3, "XSVLDLTG" = 3)) %>%
  kable_styling(latex_options = c("striped", "HOLD_position"), position = "center") %>%
  kableExtra::footnote(general = "BMI = body mass idnex; WHR = waist hip ratio; BF = body fat percentage; SVLDLTG = Triglycerides in small VLDL; XSVLDLTG = Triglycerides in very small VLDL.", threeparttable = T, general_title = "", footnote_as_chunk = T)


                    

```
-->

